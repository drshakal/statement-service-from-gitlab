<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="        http://www.springframework.org/schema/beans https://www.springframework.org/schema/beans/spring-beans.xsd        http://camel.apache.org/schema/spring       https://camel.apache.org/schema/spring/camel-spring.xsd">
    <bean id = "accountDetailsProcessor" class= "in.co.dhdigital.processors.AccountDetailsProcessor" />
    <bean id = "accountDetailsAggretor" class="in.co.dhdigital.aggregators.AccountDetailsAggregator"/>
    <camelContext id="camel" xmlns="http://camel.apache.org/schema/spring">
        <dataFormats>
         <json id="convertAccountDetailsResponse" library="Jackson"
                objectMapper="com.camel.CustomObjectMapper" unmarshalTypeName="in.co.dhdigital.models.AccountDetailsResponse"/>
      <json id="convertRestartResponse" library="Jackson"
                objectMapper="com.camel.CustomObjectMapper" unmarshalTypeName="in.co.dhdigital.models.RestartResponse"/>
    
        </dataFormats>
        <restConfiguration bindingMode="json" component="jetty"
            host="0.0.0.0" port="8081"/>
        <rest id="rest-id" path="/api/v1/statement">
            <get id="get-account-details"
                outType="in.co.dhdigital.models.StatementServiceResponse" uri="/{accountnumber}">
                <to id="_to1" uri="direct:get-account-details-route"/>
            </get>
        </rest>
        <route id="get-account-details-route">
            <from id="_from1" uri="direct:get-account-details-route"/>
            <log id="_log1" message="Inside get-account-details-route"/>
            <log id="_log2" message="Headers: ${headers}"/>
          
                <toD id="_to2" uri="http://account-details-statement-service.apps.ocp4-cluster-002.int.dhdigital.co.in/api/v1/accountdetails/${headers.accountnumber}?bridgeEndpoint=true"/>
                <unmarshal id="_unmarshal1" >
                	<custom ref="convertAccountDetailsResponse"  />
                </unmarshal>
              <!-- <process id = "process1" ref="accountDetailsProcessor"/>  -->
       			<enrich id="_enrich1" strategyRef="accountDetailsAggretor">
                	<constant>direct:get-restart</constant>
            	</enrich>
            	<log id = "_log4" message="StatementServiceResponse: ${body} "/>
<!--           	   <doTry id="_doTry3">
                <doCatch id="_doCatch3">
                    <exception>java.lang.Exception</exception>
                    <log id="_log3" message="Error while calling Transaction Service: ${body} "/>
                </doCatch>
            </doTry>  -->
        </route>
        <route id ="get-restart">
        	<from id = "from2" uri="direct:get-restart"/>
        	<setBody >
        		<constant></constant>
        	</setBody>
        	<toD id="to3" uri= "http://restart-service-statement-service.apps.ocp4-cluster-002.int.dhdigital.co.in/api/v1/restart?bridgeEndpoint=true"/>
        	  <unmarshal id="_unmarshal2" >
                	<custom ref="convertRestartResponse"  />
               </unmarshal>
        	<log id= "log4" message="RestartResponse: ${body}"/>
        </route>
    </camelContext>
</beans>
